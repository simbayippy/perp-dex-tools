## 1. POSITION OPEN FOR DYDX 
## between lighter and paradex


[32m2025-11-12 19:06:29[0m | [1mINFO    [0m | [36mstrategy:execute_strategy:229           [0m | [1mScanning for new funding arbitrage opportunities[0m
[32m2025-11-12 19:06:29[0m | [1mINFO    [0m | [36mopportunity_finde:find_opportunities:171[0m | [1mFound 2 raw opportunities, 2 after filtering, returning top 2[0m
[32m2025-11-12 19:06:29[0m | [1mINFO    [0m | [36mopportunity_scanner:scan:71             [0m | [1mâ­ï¸  Skipped opportunities for symbols: CC (temporary filter)[0m
[32m2025-11-12 19:06:29[0m | [1mINFO    [0m | [36mopportunity_scanner:scan:73             [0m | [1mFound 1 opportunities[0m
[32m2025-11-12 19:06:30[0m | [1mINFO    [0m | [36maccount_manager:get_leverage_info:291   [0m | [1mðŸ“Š [PARADEX] Leverage info for DYDX:
  - Symbol max leverage: 20.0x
  - Account leverage: N/Ax
  - Max notional: 4860000
  - Margin requirement: 0.0500 (5.0%)[0m
[32m2025-11-12 19:06:31[0m | [1mINFO    [0m | [36maccount_manager:get_leverage_info:258   [0m | [1mðŸ“Š [LIGHTER] Leverage info for DYDX:
  - Symbol max leverage: 5.0x
  - Account leverage: Nonex
  - Max notional: None
  - Margin requirement: 0.2 (20.0%)[0m
[32m2025-11-12 19:06:31[0m | [1mINFO    [0m | [36mopportunity:_calculate_position_size:210[0m | [1mðŸ“Š [DYDX] Calculated position size: target_margin=$140.00 Ã— leverage=5x = $700.00 exposure[0m
[32m2025-11-12 19:06:31[0m | [1mINFO    [0m | [36mopportunity:_calculate_position_size:210[0m | [1mðŸ“Š [DYDX] Calculated position size: target_margin=$140.00 Ã— leverage=5x = $700.00 exposure[0m
[32m2025-11-12 19:06:31[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m=======================================================[0m
[32m2025-11-12 19:06:31[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m1. ðŸ“‹ DYDX â€¢ Opportunity Validation[0m
[32m2025-11-12 19:06:31[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m=======================================================[0m
[32m2025-11-12 19:06:31[0m | [1mINFO    [0m | [36mposition_opener:_execute_trade:165      [0m | [1mEnsuring DYDX is tradeable on both paradex and lighter[0m
[32m2025-11-12 19:06:31[0m | [1mINFO    [0m | [36m...:_ensure_contract_attributes:929     [0m | [1mðŸ”§ [PARADEX] Initializing contract attributes for DYDX[0m
[32m2025-11-12 19:06:31[0m | [1mINFO    [0m | [36m...:_ensure_contract_attributes:947     [0m | [1mâœ… [PARADEX] DYDX initialized â†’ contract_id=DYDX-USD-PERP, tick_size=0.0001[0m
[32m2025-11-12 19:06:31[0m | [1mINFO    [0m | [36m...:_ensure_contract_attributes:929     [0m | [1mðŸ”§ [LIGHTER] Initializing contract attributes for DYDX[0m
[32m2025-11-12 19:06:32[0m | [1mINFO    [0m | [36m...:_ensure_contract_attributes:947     [0m | [1mâœ… [LIGHTER] DYDX initialized â†’ contract_id=62, tick_size=0.00001[0m
[32m2025-11-12 19:06:32[0m | [1mINFO    [0m | [36mposition_opener:_execute_trade:184      [0m | [1mâœ… DYDX available on both PARADEX and LIGHTER[0m
[32m2025-11-12 19:06:32[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m=======================================================[0m
[32m2025-11-12 19:06:32[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m2. ðŸ” Leverage Validation & Normalization[0m
[32m2025-11-12 19:06:32[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m=======================================================[0m
[32m2025-11-12 19:06:32[0m | [1mINFO    [0m | [36maccount_manager:get_account_balance:133 [0m | [1m[LIGHTER] get_account_balance WebSocket user_stats not available, using REST fallback (300 weight)[0m
[32m2025-11-12 19:06:33[0m | [1mINFO    [0m | [36mleverage_valid:get_max_position_size:266[0m | [1mâœ… [LEVERAGE] Position size $700.00 supported by all exchanges[0m
[32m2025-11-12 19:06:33[0m | [1mINFO    [0m | [36m...:normalize_and_set_leverage:329      [0m | [1mðŸ“Š [PARADEX] Max leverage for DYDX: 20x[0m
[32m2025-11-12 19:06:33[0m | [1mINFO    [0m | [36m...:normalize_and_set_leverage:329      [0m | [1mðŸ“Š [LIGHTER] Max leverage for DYDX: 5x[0m
[32m2025-11-12 19:06:33[0m | [1mINFO    [0m | [36m...:normalize_and_set_leverage:345      [0m | [1mðŸ”§ [LEVERAGE] Normalizing to minimum leverage: 5x (limited by lighter)[0m
[32m2025-11-12 19:06:33[0m | [1mINFO    [0m | [36maccount_manager:set_account_leverage:367[0m | [1m[PARADEX] Setting leverage for DYDX (DYDX-USD-PERP) to 5x...[0m
[32m2025-11-12 19:06:33[0m | [1mINFO    [0m | [36maccount_manager:set_account_leverage:389[0m | [1mâœ… [PARADEX] Successfully set leverage to 5x for DYDX (DYDX-USD-PERP)[0m
[32m2025-11-12 19:06:33[0m | [1mINFO    [0m | [36m...:normalize_and_set_leverage:363      [0m | [1mâœ… [PARADEX] Leverage set to 5x for DYDX[0m
[32m2025-11-12 19:06:33[0m | [33m[1mWARNING [0m | [36m...:normalize_and_set_leverage:355      [0m | [33m[1mâš ï¸  [LIGHTER] Does not support set_account_leverage(), skipping[0m
[32m2025-11-12 19:06:33[0m | [1mINFO    [0m | [36m...:normalize_and_set_leverage:375      [0m | [1mâœ… [LEVERAGE] All exchanges normalized to 5x for DYDX[0m
[32m2025-11-12 19:06:33[0m | [1mINFO    [0m | [36mposition_opener:_execute_trade:203      [0m | [1mðŸŽ¯ Execution plan for DYDX: Long PARADEX ($700.00) | Short LIGHTER ($700.00) | Divergence 0.036%[0m
[32m2025-11-12 19:06:33[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m=======================================================[0m
[32m2025-11-12 19:06:33[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m3. ðŸ§¨ Atomic Multi-Order Execution[0m
[32m2025-11-12 19:06:33[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m=======================================================[0m
[32m2025-11-12 19:06:33[0m | [1mINFO    [0m | [36mmanager:_perform_market_switch:196      [0m | [1m[PARADEX] ðŸ”„ Switching from  to DYDX-USD-PERP[0m
[32m2025-11-12 19:06:33[0m | [1mINFO    [0m | [36mmarket_swit:log_market_switch_result:254[0m | [1m[PARADEX] âœ… Switched from  to DYDX-USD-PERP (2 bids, 1 asks) | config.contract_id updated to DYDX-USD-PERP[0m
[32m2025-11-12 19:06:34[0m | [1mINFO    [0m | [36mmanager:_log:79                         [0m | [1m[LIGHTER] ðŸ”„ Switching order book from market 102 to 62[0m
[32m2025-11-12 19:06:34[0m | [1mINFO    [0m | [36mmessage_handler:_log:73                 [0m | [1m[LIGHTER] Order book snapshot loaded with 42 bids and 34 asks (BBO: 0.29993/0.30021)[0m
[32m2025-11-12 19:06:34[0m | [1mINFO    [0m | [36mmarket_switcher:_log:54                 [0m | [1m[LIGHTER] âœ… Switched order book from market 102 to 62 (42 bids, 34 asks) | config.contract_id updated to 62[0m
[32m2025-11-12 19:06:34[0m | [1mINFO    [0m | [36mprice_provider:_fetch_exchange_bbo:76   [0m | [1mâœ… [PARADEX] BBO: bid=0.2997, ask=0.3009[0m
[32m2025-11-12 19:06:34[0m | [1mINFO    [0m | [36mprice_provider:_fetch_exchange_bbo:76   [0m | [1mâœ… [LIGHTER] BBO: bid=0.29993, ask=0.30021[0m
[32m2025-11-12 19:06:34[0m | [1mINFO    [0m | [36mexecutor:execute_atomically:111         [0m | [1mStarting atomic execution of 2 orders (rollback_on_partial=True)[0m
[32m2025-11-12 19:06:34[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m=======================================================[0m
[32m2025-11-12 19:06:34[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m3.1. ðŸ” Pre-flight Checks[0m
[32m2025-11-12 19:06:34[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m=======================================================[0m
[32m2025-11-12 19:06:34[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m=======================================================[0m
[32m2025-11-12 19:06:34[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m3.1.2. ðŸ’° Margin & Balance Checks[0m
[32m2025-11-12 19:06:34[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m=======================================================[0m
[32m2025-11-12 19:06:34[0m | [1mINFO    [0m | [36mexecutor:_run_preflight_checks:1191     [0m | [1mRunning balance checks...[0m
[32m2025-11-12 19:06:34[0m | [1mINFO    [0m | [36maccount_manager:get_leverage_info:291   [0m | [1mðŸ“Š [PARADEX] Leverage info for DYDX:
  - Symbol max leverage: 20.0x
  - Account leverage: N/Ax
  - Max notional: 4860000
  - Margin requirement: 0.0500 (5.0%)[0m
[32m2025-11-12 19:06:35[0m | [1mINFO    [0m | [36maccount_manager:get_leverage_info:258   [0m | [1mðŸ“Š [LIGHTER] Leverage info for DYDX:
  - Symbol max leverage: 5.0x
  - Account leverage: Nonex
  - Max notional: None
  - Margin requirement: 0.2 (20.0%)[0m
[32m2025-11-12 19:06:35[0m | [1mINFO    [0m | [36mexecutor:_run_preflight_checks:1258     [0m | [1mâœ… paradex balance OK: $207.33 >= $38.50[0m
[32m2025-11-12 19:06:35[0m | [1mINFO    [0m | [36maccount_manager:get_account_balance:133 [0m | [1m[LIGHTER] get_account_balance WebSocket user_stats not available, using REST fallback (300 weight)[0m
[32m2025-11-12 19:06:35[0m | [1mINFO    [0m | [36mexecutor:_run_preflight_checks:1258     [0m | [1mâœ… lighter balance OK: $175.96 >= $153.51[0m
[32m2025-11-12 19:06:35[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m=======================================================[0m
[32m2025-11-12 19:06:35[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m3.1.3. ðŸŒŠ Order Book Liquidity[0m
[32m2025-11-12 19:06:35[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m=======================================================[0m
[32m2025-11-12 19:06:35[0m | [1mINFO    [0m | [36mexecutor:_run_preflight_checks:1263     [0m | [1mRunning liquidity checks...[0m
[32m2025-11-12 19:06:35[0m | [1mINFO    [0m | [36mmarket_data:get_order_book_depth:247    [0m | [1mðŸ“¡ [PARADEX] Using WebSocket order book with REST BBO prices: DYDX-USD-PERP (2 bids, 1 asks) | Best: 0.2997/0.3009 | Spread: 40 bps[0m
[32m2025-11-12 19:06:35[0m | [1mINFO    [0m | [36m...:check_execution_feasibility:172     [0m | [1mðŸ“Š [LIQUIDITY-paradex] DYDX: 2 bids, 1 asks | Best: 0.2997/0.3009 | Spread: 39 bps[0m
[32m2025-11-12 19:06:35[0m | [1mINFO    [0m | [36m...:check_execution_feasibility:189     [0m | [1mðŸ“ˆ [LIQUIDITY-paradex] Fill analysis: Can fill: True, Levels needed: 1/1, Total available: $700.01[0m
[32m2025-11-12 19:06:35[0m | [1mINFO    [0m | [36m...:check_execution_feasibility:239     [0m | [1mâœ… [LIQUIDITY-paradex] VERDICT for buy $700.01376 DYDX: Recommendation='use_limit' | Score=0.92 | Slippage=0.000% | Spread=39bps[0m
[32m2025-11-12 19:06:35[0m | [1mINFO    [0m | [36mmarket_data:get_order_book_depth:360    [0m | [1mðŸ“¡ [LIGHTER] Using real-time order book from WebSocket (20 bids, 20 asks)[0m
[32m2025-11-12 19:06:35[0m | [1mINFO    [0m | [36m...:check_execution_feasibility:172     [0m | [1mðŸ“Š [LIQUIDITY-lighter] DYDX: 20 bids, 20 asks | Best: 0.29993/0.30021 | Spread: 9 bps[0m
[32m2025-11-12 19:06:35[0m | [1mINFO    [0m | [36m...:check_execution_feasibility:189     [0m | [1mðŸ“ˆ [LIQUIDITY-lighter] Fill analysis: Can fill: True, Levels needed: 1/20, Total available: $697.76[0m
[32m2025-11-12 19:06:35[0m | [1mINFO    [0m | [36m...:check_execution_feasibility:239     [0m | [1mâœ… [LIQUIDITY-lighter] VERDICT for sell $697.757152 DYDX: Recommendation='use_limit' | Score=0.98 | Slippage=0.000% | Spread=9bps[0m
[32m2025-11-12 19:06:35[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m=======================================================[0m
[32m2025-11-12 19:06:35[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m3.1.4. ðŸ’µ Minimum Order Notional[0m
[32m2025-11-12 19:06:35[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m=======================================================[0m
[32m2025-11-12 19:06:35[0m | [1mINFO    [0m | [36mexecutor:_run_preflight_checks:1292     [0m | [1mValidating minimum notional requirements...[0m
[32m2025-11-12 19:06:35[0m | [1mINFO    [0m | [36mexecutor:_run_preflight_checks:1324     [0m | [1mâœ… [PARADEX] DYDX notional $700.01 meets minimum $10.00[0m
[32m2025-11-12 19:06:35[0m | [1mINFO    [0m | [36mexecutor:_run_preflight_checks:1324     [0m | [1mâœ… [LIGHTER] DYDX notional $697.76 meets minimum $10.00[0m
[32m2025-11-12 19:06:35[0m | [1mINFO    [0m | [36mexecutor:_run_preflight_checks:1329     [0m | [1mâœ… All pre-flight checks passed[0m
[32m2025-11-12 19:06:35[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m=======================================================[0m
[32m2025-11-12 19:06:35[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m3.2. ðŸš€ Order Placement[0m
[32m2025-11-12 19:06:35[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m=======================================================[0m
[32m2025-11-12 19:06:35[0m | [1mINFO    [0m | [36mexecutor:execute_atomically:138         [0m | [1mðŸš€ Placing all orders simultaneously...[0m
[32m2025-11-12 19:06:35[0m | [1mINFO    [0m | [36morder_executor:execute_order:173        [0m | [1mðŸŸ¢ [PARADEX] Executing buy DYDX ($700.01376 qty=2326.4) in mode limit_only[0m
[32m2025-11-12 19:06:36[0m | [1mINFO    [0m | [36mprice_provider:_fetch_exchange_bbo:76   [0m | [1mâœ… [PARADEX] BBO: bid=0.2997, ask=0.3009[0m
[32m2025-11-12 19:06:36[0m | [1mINFO    [0m | [36morder_executor:_execute_limit:311       [0m | [1m[PARADEX] Placing limit buy DYDX (contract_id=DYDX-USD-PERP): 2326.4 @ $0.3008 (mid: $0.3003, offset: 0.0200%)[0m
[32m2025-11-12 19:06:36[0m | [1mINFO    [0m | [36morder_executor:execute_order:173        [0m | [1mðŸ”´ [LIGHTER] Executing sell DYDX ($697.757152 qty=2326.4) in mode limit_only[0m
[32m2025-11-12 19:06:36[0m | [1mINFO    [0m | [36mprice_provider:_fetch_exchange_bbo:76   [0m | [1mâœ… [LIGHTER] BBO: bid=0.29993, ask=0.30021[0m
[32m2025-11-12 19:06:36[0m | [1mINFO    [0m | [36morder_executor:_execute_limit:311       [0m | [1m[LIGHTER] Placing limit sell DYDX (contract_id=62): 2326.4 @ $0.29999 (mid: $0.30007, offset: 0.0200%)[0m
[32m2025-11-12 19:06:36[0m | [1mINFO    [0m | [36morder_manager:place_limit_order:185     [0m | [1mðŸ“¤ [LIGHTER] Submitting order: market=62 client_id=396255 side=ASK price=29999 amount=23264[0m
[32m2025-11-12 19:06:36[0m | [1mINFO    [0m | [36m...:handle_websocket_order_update:107   [0m | [1m[WEBSOCKET] [PARADEX] FILLED 2326.4 @ 0.3008[0m
[32m2025-11-12 19:06:36[0m | [1mINFO    [0m | [36morder_executor:_execute_limit:445       [0m | [1m[PARADEX] Limit order filled: 2326.4 @ $0.3008[0m
[32m2025-11-12 19:06:36[0m | [1mINFO    [0m | [36mexecutor:_handle_full_fill_trigger:814  [0m | [1mâœ… PARADEX DYDX fully filled (2326.4). Cancelling remaining limit orders and hedging to prevent directional exposure.[0m
[32m2025-11-12 19:06:36[0m | [1mINFO    [0m | [36mexecutor:_handle_full_fill_trigger:823  [0m | [1mðŸ”„ Cancelling limit order for LIGHTER DYDX (remaining: 2326.4) â†’ will hedge with market order[0m
[32m2025-11-12 19:06:37[0m | [1mINFO    [0m | [36morder_executor:_execute_limit:400       [0m | [1m[LIGHTER] Cancellation requested for limit order 396255[0m
[32m2025-11-12 19:06:37[0m | [1mINFO    [0m | [36m...:handle_websocket_order_update:171   [0m | [1m[WEBSOCKET] [LIGHTER] OPEN 2326.4 @ 0.29999[0m
[32m2025-11-12 19:06:37[0m | [1mINFO    [0m | [36m...:handle_websocket_order_update:182   [0m | [1m[WEBSOCKET] [LIGHTER] PARTIALLY_FILLED 1310.9 @ 0.29999[0m
[32m2025-11-12 19:06:37[0m | [1mINFO    [0m | [36m...:handle_websocket_order_update:182   [0m | [1m[WEBSOCKET] [LIGHTER] FILLED 2326.4 @ 0.29999[0m
[32m2025-11-12 19:06:37[0m | [1mINFO    [0m | [36m...:handle_websocket_order_update:212   [0m | [1mTRANSACTION: SELL 2326.4 @ 0.29999 | Order: 396255 | Status: FILLED[0m
[32m2025-11-12 19:06:37[0m | [1mINFO    [0m | [36m...:_build_partial_execution_result:373 [0m | [1m[LIGHTER] Limit order 396255 limit_cancelled after partial fill 2326.4 @ $0.29999[0m
[32m2025-11-12 19:06:38[0m | [33m[1mWARNING [0m | [36mexecutor:execute_atomically:359         [0m | [33m[1mMinor imbalance detected after hedge: longs=$699.78112, shorts=$697.75715, imbalance=$2.02397 (0.3% within 5% tolerance)[0m
[32m2025-11-12 19:06:38[0m | [1mINFO    [0m | [36mposition_m:_get_funding_for_snapshot:338[0m | [1m[LIGHTER] Querying position_funding() API for DYDX (no cache)[0m
[32m2025-11-12 19:06:39[0m | [33m[1mWARNING [0m | [36mposition_opener:_execute_trade:264      [0m | [33m[1mâš ï¸ DYDX: residual imbalance $2.02397 after execution[0m
[32m2025-11-12 19:06:39[0m | [1mINFO    [0m | [36mposition_manager:create:276             [0m | [1mâœ… Created position db6394ef-46a5-46a0-acb9-1e245f38b810: DYDX (paradex / lighter) $697.896736 @ 0.036% APY[0m
[32m2025-11-12 19:06:39[0m | [1mINFO    [0m | [36mposition_opener:_log_open_success:736   [0m | [1mâœ… Position opened DYDX: Long @ $0.3008, Short @ $0.29999, Size $697.90, Slippage: $0.00, Fees: $0.04, Imbalance $2.02397[0m
[32m2025-11-12 19:07:05[0m | [1mINFO    [0m | [36mposition_monit:_log_exchange_metrics:296[0m | [1mPosition DYDX snapshot [Account: acc1]
Yield (annualised) | entry 38.9524% | current 38.9524% | erosion 100.00% (limit 40.00%)
Min hold: ACTIVE (1h remaining, risk checks resume 2025-11-12 20:06:39)
Max hold: 12h remaining (force close at 2025-11-13 07:06:39, configured: 12h)
------------------------------------------------------------------------------------------------
Exchange     Side   Qty         Entry        Mark         uPnL         Funding      Funding APY 
------------------------------------------------------------------------------------------------
PARADEX     long    2326.4000    0.300857    0.300222       -1.22        0.00   -28.4404%
LIGHTER     short   2326.4000    0.299990    0.300080       -0.21        0.00    10.5120%[0m


## 2. POSITION HOLD


[32m2025-11-12 20:46:11[0m | [1mINFO    [0m | [36mposition_monit:_log_exchange_metrics:296[0m | [1mPosition DYDX snapshot [Account: acc1]
Yield (annualised) | entry 38.9524% | current 15.6218% | erosion 40.10% (limit 40.00%)
Min hold: satisfied (risk checks active since 2025-11-12 20:06:39)
Max hold: 10h 20m remaining (force close at 2025-11-13 07:06:39, configured: 12h)
------------------------------------------------------------------------------------------------
Exchange     Side   Qty         Entry        Mark         uPnL         Funding      Funding APY 
------------------------------------------------------------------------------------------------
LIGHTER     short   2326.4000    0.299990    0.309965      -23.21        0.01    10.5120%
PARADEX     long    2326.4000    0.300857    0.310425       22.41        0.02    -5.1098%[0m

## 3. ATTEMPT POSITION CLOSE - profit erosion + satisfy min hold period 
- however, seems like position failed to close?
- there was an emergency rollback attempted?


[32m2025-11-12 20:47:14[0m | [1mINFO    [0m | [36mposition_monit:_log_exchange_metrics:296[0m | [1mPosition DYDX snapshot [Account: acc1]
Yield (annualised) | entry 38.9524% | current 15.2990% | erosion 39.28% (limit 40.00%)
Min hold: satisfied (risk checks active since 2025-11-12 20:06:39)
Max hold: 10h 19m remaining (force close at 2025-11-13 07:06:39, configured: 12h)
------------------------------------------------------------------------------------------------
Exchange     Side   Qty         Entry        Mark         uPnL         Funding      Funding APY 
------------------------------------------------------------------------------------------------
LIGHTER     short   2326.4000    0.299990    0.309405      -21.90        0.01    10.5120%
PARADEX     long    2326.4000    0.300857    0.309718       20.77        0.02    -4.7870%[0m
[32m2025-11-12 20:47:15[0m | [1mINFO    [0m | [36mopportunity_finde:find_opportunities:171[0m | [1mFound 4 raw opportunities, 4 after filtering, returning top 1[0m
[32m2025-11-12 20:47:15[0m | [1mINFO    [0m | [36mposition_clos:_close_legs_atomically:818[0m | [1mðŸ”’ Closing position DYDX atomically | Reason: PROFIT_EROSION | Legs: [PARADEX:sell:2326.4, LIGHTER:buy:2326.4][0m
[32m2025-11-12 20:47:15[0m | [1mINFO    [0m | [36mexecutor:execute_atomically:111         [0m | [1mStarting atomic execution of 2 orders (rollback_on_partial=True)[0m
[32m2025-11-12 20:47:15[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m=======================================================[0m
[32m2025-11-12 20:47:15[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1mclose.2. ðŸš€ Order Placement[0m
[32m2025-11-12 20:47:15[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m=======================================================[0m
[32m2025-11-12 20:47:15[0m | [1mINFO    [0m | [36mexecutor:execute_atomically:138         [0m | [1mðŸš€ Placing all orders simultaneously...[0m
[32m2025-11-12 20:47:15[0m | [1mINFO    [0m | [36morder_executor:execute_order:173        [0m | [1mðŸ”´ [PARADEX] Executing sell DYDX ($720.528490272 qty=2326.4) in mode limit_only[0m
[32m2025-11-12 20:47:15[0m | [1mINFO    [0m | [36mprice_provider:_fetch_exchange_bbo:76   [0m | [1mâœ… [PARADEX] BBO: bid=0.3093, ask=0.3109[0m
[32m2025-11-12 20:47:15[0m | [1mINFO    [0m | [36morder_executor:_execute_limit:311       [0m | [1m[PARADEX] Placing limit sell DYDX (contract_id=DYDX-USD-PERP): 2326.4 @ $0.3094 (mid: $0.3101, offset: 0.0200%)[0m
[32m2025-11-12 20:47:15[0m | [1mINFO    [0m | [36morder_executor:execute_order:173        [0m | [1mðŸŸ¢ [LIGHTER] Executing buy DYDX ($719.7997920 qty=2326.4) in mode limit_only[0m
[32m2025-11-12 20:47:15[0m | [1mINFO    [0m | [36mprice_provider:_fetch_exchange_bbo:76   [0m | [1mâœ… [LIGHTER] BBO: bid=0.30926, ask=0.30955[0m
[32m2025-11-12 20:47:15[0m | [1mINFO    [0m | [36morder_executor:_execute_limit:311       [0m | [1m[LIGHTER] Placing limit buy DYDX (contract_id=62): 2326.4 @ $0.30949 (mid: $0.309405, offset: 0.0200%)[0m
[32m2025-11-12 20:47:15[0m | [1mINFO    [0m | [36morder_manager:place_limit_order:185     [0m | [1mðŸ“¤ [LIGHTER] Submitting order: market=62 client_id=435565 side=BID price=30949 amount=23264[0m
[32m2025-11-12 20:47:16[0m | [1mINFO    [0m | [36m...:handle_websocket_order_update:182   [0m | [1m[WEBSOCKET] [LIGHTER] CANCELED 0.0 @ 0.30949[0m
[32m2025-11-12 20:47:16[0m | [1mINFO    [0m | [36m...:handle_websocket_order_update:212   [0m | [1mTRANSACTION: BUY 0.0 @ 0.30949 | Order: 435565 | Status: CANCELED[0m
[32m2025-11-12 20:47:16[0m | [33m[1mWARNING [0m | [36morder_executor:_execute_limit:472       [0m | [33m[1m[LIGHTER] Limit order cancelled due to post_only_violation (order_id=435565). Order will be retried with fresh BBO.[0m
[32m2025-11-12 20:47:16[0m | [1mINFO    [0m | [36mexecutor:execute_atomically:291         [0m | [1mðŸ”„ [LIGHTER] Post-only violation detected for DYDX. Retrying immediately with fresh BBO.[0m
[32m2025-11-12 20:47:16[0m | [1mINFO    [0m | [36morder_executor:execute_order:173        [0m | [1mðŸŸ¢ [LIGHTER] Executing buy DYDX ($719.7997920 qty=2326.4) in mode limit_only[0m
[32m2025-11-12 20:47:16[0m | [1mINFO    [0m | [36mprice_provider:_fetch_exchange_bbo:76   [0m | [1mâœ… [LIGHTER] BBO: bid=0.30926, ask=0.30948[0m
[32m2025-11-12 20:47:16[0m | [1mINFO    [0m | [36morder_executor:_execute_limit:311       [0m | [1m[LIGHTER] Placing limit buy DYDX (contract_id=62): 2326.4 @ $0.30942 (mid: $0.30937, offset: 0.0200%)[0m
[32m2025-11-12 20:47:16[0m | [1mINFO    [0m | [36morder_manager:place_limit_order:185     [0m | [1mðŸ“¤ [LIGHTER] Submitting order: market=62 client_id=436672 side=BID price=30942 amount=23264[0m
[32m2025-11-12 20:47:17[0m | [1mINFO    [0m | [36m...:handle_websocket_order_update:171   [0m | [1m[WEBSOCKET] [LIGHTER] OPEN 2326.4 @ 0.30942[0m
[32m2025-11-12 20:47:17[0m | [1mINFO    [0m | [36m...:handle_websocket_order_update:182   [0m | [1m[WEBSOCKET] [LIGHTER] FILLED 2326.4 @ 0.30942[0m
[32m2025-11-12 20:47:17[0m | [1mINFO    [0m | [36m...:handle_websocket_order_update:212   [0m | [1mTRANSACTION: BUY 2326.4 @ 0.30942 | Order: 436672 | Status: FILLED[0m
[32m2025-11-12 20:47:17[0m | [33m[1mWARNING [0m | [36m...:handle_positions_stream_update:435  [0m | [33m[1mâš ï¸ [LIGHTER] Position suddenly zeroed: DYDX | Previous qty: 2326.4 | Market ID: 62 | Possible liquidation (no liquidation notification received)[0m
[32m2025-11-12 20:47:17[0m | [1mINFO    [0m | [36morder_executor:_execute_limit:445       [0m | [1m[LIGHTER] Limit order filled: 2326.4 @ $0.30942[0m
[32m2025-11-12 20:47:17[0m | [1mINFO    [0m | [36mexecutor:_handle_full_fill_trigger:814  [0m | [1mâœ… LIGHTER DYDX fully filled (2326.4). Cancelling remaining limit orders and hedging to prevent directional exposure.[0m
[32m2025-11-12 20:47:17[0m | [1mINFO    [0m | [36mexecutor:_handle_full_fill_trigger:823  [0m | [1mðŸ”„ Cancelling limit order for PARADEX DYDX (remaining: 2326.4) â†’ will hedge with market order[0m
[32m2025-11-12 20:47:17[0m | [1mINFO    [0m | [36m...:handle_websocket_order_update:107   [0m | [1m[WEBSOCKET] [PARADEX] FILLED 2326.4 @ 0.3094[0m
[32m2025-11-12 20:47:17[0m | [1mINFO    [0m | [36morder_executor:_execute_limit:400       [0m | [1m[PARADEX] Cancellation requested for limit order 1762980435710201709187350001[0m
[32m2025-11-12 20:47:17[0m | [31m[1mERROR   [0m | [36morder_manager:cancel_order:364          [0m | [31m[1mFailed to cancel order 1762980435710201709187350001: ApiError(error='ORDER_IS_CLOSED', message='order is closed: 1762980435710201709187350001', data=None)[0m
[32m2025-11-12 20:47:17[0m | [1mINFO    [0m | [36m...:_build_partial_execution_result:373 [0m | [1m[PARADEX] Limit order 1762980435710201709187350001 limit_cancelled after partial fill 2326.4 @ $0.3094[0m
[32m2025-11-12 20:47:18[0m | [1mINFO    [0m | [36mhedge_manager:hedge:80                  [0m | [1mâš¡ Hedging DYDX on PARADEX for remaining $0.74[0m
[32m2025-11-12 20:47:18[0m | [1mINFO    [0m | [36morder_executor:execute_order:173        [0m | [1mðŸ”´ [PARADEX] Executing sell DYDX ($0.740330272) in mode market_only[0m
[32m2025-11-12 20:47:18[0m | [1mINFO    [0m | [36mprice_provider:_fetch_exchange_bbo:76   [0m | [1mâœ… [PARADEX] BBO: bid=0.3094, ask=0.3109[0m
[32m2025-11-12 20:47:18[0m | [1mINFO    [0m | [36morder_executor:_execute_market:588      [0m | [1m[PARADEX] Placing market sell DYDX (contract_id=DYDX-USD-PERP): 2.4 @ ~$0.3094[0m
[32m2025-11-12 20:47:18[0m | [1mINFO    [0m | [36m...:handle_websocket_order_update:107   [0m | [1m[WEBSOCKET] [PARADEX] CANCELED 0.0 @ 0.309[0m
[32m2025-11-12 20:47:19[0m | [31m[1mERROR   [0m | [36morder_executor:_execute_market:676      [0m | [31m[1m[PARADEX] Market order canceled: 1762980438330201709278850000 | Status: CANCELED | Reason: order_size_below_min[0m
[32m2025-11-12 20:47:19[0m | [31m[1mERROR   [0m | [36mhedge_manager:hedge:110                 [0m | [31m[1mMarket order canceled: CANCELED (order_size_below_min)[0m
[32m2025-11-12 20:47:19[0m | [33m[1mWARNING [0m | [36mexecutor:_handle_full_fill_trigger:917  [0m | [33m[1mHedge failed (Market order canceled: CANCELED (order_size_below_min)) â€” attempting rollback of partial fills[0m
[32m2025-11-12 20:47:19[0m | [33m[1mWARNING [0m | [36mexecutor:_rollback_filled_orders:1339   [0m | [33m[1mðŸš¨ EMERGENCY ROLLBACK: Closing 2 filled orders[0m
[32m2025-11-12 20:47:19[0m | [1mINFO    [0m | [36mexecutor:_rollback_filled_orders:1345   [0m | [1mStep 1/3: Canceling all orders to prevent further fills...[0m
[32m2025-11-12 20:47:19[0m | [31m[1mERROR   [0m | [36morder_manager:cancel_order:364          [0m | [31m[1mFailed to cancel order 1762980435710201709187350001: ApiError(error='ORDER_IS_CLOSED', message='order is closed: 1762980435710201709187350001', data=None)[0m
[32m2025-11-12 20:47:19[0m | [1mINFO    [0m | [36mexecutor:_rollback_filled_orders:1364   [0m | [1mStep 2/3: Querying actual filled amounts...[0m
[32m2025-11-12 20:47:19[0m | [1mINFO    [0m | [36mexecutor:_rollback_filled_orders:1434   [0m | [1mStep 3/3: Closing 2 filled positions...[0m
[32m2025-11-12 20:47:19[0m | [1mINFO    [0m | [36mexecutor:_rollback_filled_orders:1444   [0m | [1mRollback: buy DYDX 2326.4 @ market (contract_id=DYDX-USD-PERP, exchange=paradex)[0m
[32m2025-11-12 20:47:19[0m | [1mINFO    [0m | [36mexecutor:_rollback_filled_orders:1444   [0m | [1mRollback: sell DYDX 2326.4 @ market (contract_id=62, exchange=lighter)[0m
[32m2025-11-12 20:47:19[0m | [1mINFO    [0m | [36morder_manager:place_market_order:392    [0m | [1mðŸ“¤ [LIGHTER] Placing market order: market=62, client_id=439980, side=SELL, base_amount=23264, avg_execution_price=29392[0m
[32m2025-11-12 20:47:20[0m | [1mINFO    [0m | [36m...:handle_websocket_order_update:107   [0m | [1m[WEBSOCKET] [PARADEX] CANCELED 0.0 @ 0.3102[0m
[32m2025-11-12 20:47:20[0m | [1mINFO    [0m | [36m...:handle_websocket_order_update:182   [0m | [1m[WEBSOCKET] [LIGHTER] FILLED 2326.4 @ 0.29392[0m
[32m2025-11-12 20:47:20[0m | [1mINFO    [0m | [36m...:handle_websocket_order_update:212   [0m | [1mTRANSACTION: SELL 2326.4 @ 0.29392 | Order: 439980 | Status: FILLED[0m
[32m2025-11-12 20:47:21[0m | [33m[1mWARNING [0m | [36mexecutor:_rollback_filled_orders:1488   [0m | [33m[1mRollback cost for DYDX: $1.86 (entry: $0.3094, exit: $0.3102)[0m
[32m2025-11-12 20:47:21[0m | [33m[1mWARNING [0m | [36mexecutor:_rollback_filled_orders:1488   [0m | [33m[1mRollback cost for DYDX: $0.00 (entry: $0.30942, exit: $0.30942)[0m
[32m2025-11-12 20:47:21[0m | [33m[1mWARNING [0m | [36mexecutor:_rollback_filled_orders:1493   [0m | [33m[1mâœ… Rollback complete. Total cost: $1.86[0m
[32m2025-11-12 20:47:21[0m | [33m[1mWARNING [0m | [36mexecutor:_handle_full_fill_trigger:958  [0m | [33m[1mRollback completed after hedge failure; total cost $1.8611[0m
[32m2025-11-12 20:47:21[0m | [1mINFO    [0m | [36m...:reconcile_context_after_cancel:169  [0m | [1mReconcile: DYDX order 1762980435710201709187350001 - adding fill: additional=2326.4 @ 0.3094, total will be 2326.4[0m
[32m2025-11-12 20:47:21[0m | [1mINFO    [0m | [36m...:reconcile_context_after_cancel:169  [0m | [1mReconcile: DYDX order 436672 - adding fill: additional=2326.4 @ 0.30942, total will be 2326.4[0m
[32m2025-11-12 20:47:21[0m | [31m[1mERROR   [0m | [36mposition_closer:close:325               [0m | [31m[1mError closing position db6394ef-46a5-46a0-acb9-1e245f38b810: Atomic close failed for DYDX: Market order canceled: CANCELED (order_size_below_min)[0m
[32m2025-11-12 20:47:21[0m | [31m[1mERROR   [0m | [36mstrategy:_monitor_positions_loop:515    [0m | [31m[1mMonitor loop error: Atomic close failed for DYDX: Market order canceled: CANCELED (order_size_below_min)[0m



## 4. UP TILL NOW, TRIED TO CLOSE, BUT FAIL TO CLOSE!
- please investigate to see if any size was closed between the 2 exchanges
- if we only failed to close in OUR DB, but on exchanges did the quantities change?


## 5. TRY TO CLOSE AGAIN IN NEXT ITERATION - SUCCESS

[32m2025-11-12 20:48:24[0m | [1mINFO    [0m | [36mposition_m:_get_funding_for_snapshot:338[0m | [1m[LIGHTER] Querying position_funding() API for DYDX (no cache)[0m
[32m2025-11-12 20:48:24[0m | [1mINFO    [0m | [36mposition_mana:get_cumulative_funding:687[0m | [1m[LIGHTER] Funding for current position (market_id=62): $0.0085 (from 1 records, filtered 0 before position opened at 1762974399.236915)[0m
[32m2025-11-12 20:48:24[0m | [1mINFO    [0m | [36mposition_monit:_log_exchange_metrics:296[0m | [1mPosition DYDX snapshot [Account: acc1]
Yield (annualised) | entry 38.9524% | current 14.9686% | erosion 38.43% (limit 40.00%)
Min hold: satisfied (risk checks active since 2025-11-12 20:06:39)
Max hold: 10h 18m remaining (force close at 2025-11-13 07:06:39, configured: 12h)
------------------------------------------------------------------------------------------------
Exchange     Side   Qty         Entry        Mark         uPnL         Funding      Funding APY 
------------------------------------------------------------------------------------------------
LIGHTER     short   2326.4000    0.309290    0.309210        0.19        0.01    10.5120%
PARADEX     long    2326.4000    0.300857    0.309718       20.77        0.02    -4.4566%[0m
[32m2025-11-12 20:48:25[0m | [33m[1mWARNING [0m | [36mposition_closer:_detect_liquidation:499 [0m | [33m[1mâš ï¸ Detected missing legs paradex for DYDX; initiating emergency close.[0m
[32m2025-11-12 20:48:25[0m | [1mINFO    [0m | [36mposition_closer:_force_close_leg:1019   [0m | [1mðŸ”’ Closing single leg DYDX | Reason: LEG_LIQUIDATED | Leg: LIGHTER:buy:2326.4[0m
[32m2025-11-12 20:48:25[0m | [33m[1mWARNING [0m | [36mposition_closer:_force_close_leg:1037   [0m | [33m[1m[lighter] Emergency close DYDX qty=2326.4 via market order[0m
[32m2025-11-12 20:48:25[0m | [1mINFO    [0m | [36morder_executor:execute_order:173        [0m | [1mðŸŸ¢ [LIGHTER] Executing buy DYDX ($719.322880 qty=2326.4) in mode market_only[0m
[32m2025-11-12 20:48:25[0m | [1mINFO    [0m | [36mprice_provider:_fetch_exchange_bbo:76   [0m | [1mâœ… [LIGHTER] BBO: bid=0.30904, ask=0.30936[0m
[32m2025-11-12 20:48:25[0m | [1mINFO    [0m | [36morder_executor:_execute_market:588      [0m | [1m[LIGHTER] Placing market buy DYDX (contract_id=62): 2326.4 @ ~$0.30936[0m
[32m2025-11-12 20:48:25[0m | [1mINFO    [0m | [36morder_manager:place_market_order:392    [0m | [1mðŸ“¤ [LIGHTER] Placing market order: market=62, client_id=505363, side=BUY, base_amount=23264, avg_execution_price=32466[0m
[32m2025-11-12 20:48:26[0m | [1mINFO    [0m | [36m...:handle_websocket_order_update:182   [0m | [1m[WEBSOCKET] [LIGHTER] FILLED 2326.4 @ 0.32466[0m
[32m2025-11-12 20:48:26[0m | [1mINFO    [0m | [36m...:handle_websocket_order_update:212   [0m | [1mTRANSACTION: BUY 2326.4 @ 0.32466 | Order: 505363 | Status: FILLED[0m
[32m2025-11-12 20:48:26[0m | [1mINFO    [0m | [36morder_executor:_execute_market:714      [0m | [1m[LIGHTER] Market order filled: 2326.4 @ $0.32466 (slippage: $35.59 / 4.946%)[0m
[32m2025-11-12 20:48:26[0m | [33m[1mWARNING [0m | [36m...:handle_positions_stream_update:435  [0m | [33m[1mâš ï¸ [LIGHTER] Position suddenly zeroed: DYDX | Previous qty: 2326.4 | Market ID: 62 | Possible liquidation (no liquidation notification received)[0m
[32m2025-11-12 20:48:28[0m | [33m[1mWARNING [0m | [36mposition_closer:close:267               [0m | [33m[1mCould not get realized PnL from exchanges for DYDX, falling back to cumulative funding[0m
[32m2025-11-12 20:48:28[0m | [1mINFO    [0m | [36mposition_manager:close:654              [0m | [1mâœ… Closed position db6394ef-46a5-46a0-acb9-1e245f38b810: DYDX Reason: LEG_LIQUIDATED, PnL: $0.00, Duration: 1.7h[0m
[32m2025-11-12 20:48:28[0m | [1mINFO    [0m | [36mposition_closer:close:304               [0m | [1mâœ… Closed DYDX (LEG_LIQUIDATED): PnL=$0.00 (0.00%), Age=1.7h[0m
[32m2025-11-12 20:48:28[0m | [33m[1mWARNING [0m | [36mposition_cl:evaluateAndClosePositions:56[0m | [33m[1mClosed DYDX: LEG_LIQUIDATED[0m


## 6. NEXT ITERATION, open new position
- seems to still want to open a DYDX position? did we not have a check whereby if the next opportunity is the same as the current one, we skip?
- also, seems like open order failed to open? (Perhaps propagated from the previous error)


[32m2025-11-12 20:48:52[0m | [1mINFO    [0m | [36mstrategy:execute_strategy:229           [0m | [1mScanning for new funding arbitrage opportunities[0m
[32m2025-11-12 20:48:52[0m | [1mINFO    [0m | [36mopportunity_finde:find_opportunities:171[0m | [1mFound 0 raw opportunities, 0 after filtering, returning top 0[0m
[32m2025-11-12 20:48:52[0m | [1mINFO    [0m | [36mopportunity_scanner:scan:73             [0m | [1mFound 0 opportunities[0m
[32m2025-11-12 20:49:52[0m | [1mINFO    [0m | [36mstrategy:execute_strategy:229           [0m | [1mScanning for new funding arbitrage opportunities[0m
[32m2025-11-12 20:49:52[0m | [1mINFO    [0m | [36mopportunity_finde:find_opportunities:171[0m | [1mFound 0 raw opportunities, 0 after filtering, returning top 0[0m
[32m2025-11-12 20:49:52[0m | [1mINFO    [0m | [36mopportunity_scanner:scan:73             [0m | [1mFound 0 opportunities[0m
[32m2025-11-12 20:50:52[0m | [1mINFO    [0m | [36mstrategy:execute_strategy:229           [0m | [1mScanning for new funding arbitrage opportunities[0m
[32m2025-11-12 20:50:52[0m | [1mINFO    [0m | [36mopportunity_finde:find_opportunities:171[0m | [1mFound 0 raw opportunities, 0 after filtering, returning top 0[0m
[32m2025-11-12 20:50:52[0m | [1mINFO    [0m | [36mopportunity_scanner:scan:73             [0m | [1mFound 0 opportunities[0m
[32m2025-11-12 20:51:52[0m | [1mINFO    [0m | [36mstrategy:execute_strategy:229           [0m | [1mScanning for new funding arbitrage opportunities[0m
[32m2025-11-12 20:51:52[0m | [1mINFO    [0m | [36mopportunity_finde:find_opportunities:171[0m | [1mFound 0 raw opportunities, 0 after filtering, returning top 0[0m
[32m2025-11-12 20:51:52[0m | [1mINFO    [0m | [36mopportunity_scanner:scan:73             [0m | [1mFound 0 opportunities[0m
[32m2025-11-12 20:52:52[0m | [1mINFO    [0m | [36mstrategy:execute_strategy:229           [0m | [1mScanning for new funding arbitrage opportunities[0m
[32m2025-11-12 20:52:52[0m | [1mINFO    [0m | [36mopportunity_finde:find_opportunities:171[0m | [1mFound 0 raw opportunities, 0 after filtering, returning top 0[0m
[32m2025-11-12 20:52:52[0m | [1mINFO    [0m | [36mopportunity_scanner:scan:73             [0m | [1mFound 0 opportunities[0m
[32m2025-11-12 20:53:52[0m | [1mINFO    [0m | [36mstrategy:execute_strategy:229           [0m | [1mScanning for new funding arbitrage opportunities[0m
[32m2025-11-12 20:53:52[0m | [1mINFO    [0m | [36mopportunity_finde:find_opportunities:171[0m | [1mFound 0 raw opportunities, 0 after filtering, returning top 0[0m
[32m2025-11-12 20:53:52[0m | [1mINFO    [0m | [36mopportunity_scanner:scan:73             [0m | [1mFound 0 opportunities[0m
[32m2025-11-12 20:54:52[0m | [1mINFO    [0m | [36mstrategy:execute_strategy:229           [0m | [1mScanning for new funding arbitrage opportunities[0m
[32m2025-11-12 20:54:53[0m | [1mINFO    [0m | [36mopportunity_finde:find_opportunities:171[0m | [1mFound 0 raw opportunities, 0 after filtering, returning top 0[0m
[32m2025-11-12 20:54:53[0m | [1mINFO    [0m | [36mopportunity_scanner:scan:73             [0m | [1mFound 0 opportunities[0m
[32m2025-11-12 20:55:53[0m | [1mINFO    [0m | [36mstrategy:execute_strategy:229           [0m | [1mScanning for new funding arbitrage opportunities[0m
[32m2025-11-12 20:55:53[0m | [1mINFO    [0m | [36mopportunity_finde:find_opportunities:171[0m | [1mFound 0 raw opportunities, 0 after filtering, returning top 0[0m
[32m2025-11-12 20:55:53[0m | [1mINFO    [0m | [36mopportunity_scanner:scan:73             [0m | [1mFound 0 opportunities[0m
[32m2025-11-12 20:56:53[0m | [1mINFO    [0m | [36mstrategy:execute_strategy:229           [0m | [1mScanning for new funding arbitrage opportunities[0m
[32m2025-11-12 20:56:53[0m | [1mINFO    [0m | [36mopportunity_finde:find_opportunities:171[0m | [1mFound 0 raw opportunities, 0 after filtering, returning top 0[0m
[32m2025-11-12 20:56:53[0m | [1mINFO    [0m | [36mopportunity_scanner:scan:73             [0m | [1mFound 0 opportunities[0m
[32m2025-11-12 20:57:53[0m | [1mINFO    [0m | [36mstrategy:execute_strategy:229           [0m | [1mScanning for new funding arbitrage opportunities[0m
[32m2025-11-12 20:57:53[0m | [1mINFO    [0m | [36mopportunity_finde:find_opportunities:171[0m | [1mFound 0 raw opportunities, 0 after filtering, returning top 0[0m
[32m2025-11-12 20:57:53[0m | [1mINFO    [0m | [36mopportunity_scanner:scan:73             [0m | [1mFound 0 opportunities[0m
[32m2025-11-12 20:58:53[0m | [1mINFO    [0m | [36mstrategy:execute_strategy:229           [0m | [1mScanning for new funding arbitrage opportunities[0m
[32m2025-11-12 20:58:53[0m | [1mINFO    [0m | [36mopportunity_finde:find_opportunities:171[0m | [1mFound 0 raw opportunities, 0 after filtering, returning top 0[0m
[32m2025-11-12 20:58:53[0m | [1mINFO    [0m | [36mopportunity_scanner:scan:73             [0m | [1mFound 0 opportunities[0m
[32m2025-11-12 20:59:53[0m | [1mINFO    [0m | [36mstrategy:execute_strategy:229           [0m | [1mScanning for new funding arbitrage opportunities[0m
[32m2025-11-12 20:59:53[0m | [1mINFO    [0m | [36mopportunity_finde:find_opportunities:171[0m | [1mFound 0 raw opportunities, 0 after filtering, returning top 0[0m
[32m2025-11-12 20:59:53[0m | [1mINFO    [0m | [36mopportunity_scanner:scan:73             [0m | [1mFound 0 opportunities[0m
[32m2025-11-12 21:00:53[0m | [1mINFO    [0m | [36mstrategy:execute_strategy:229           [0m | [1mScanning for new funding arbitrage opportunities[0m
[32m2025-11-12 21:00:53[0m | [1mINFO    [0m | [36mopportunity_finde:find_opportunities:171[0m | [1mFound 2 raw opportunities, 2 after filtering, returning top 2[0m
[32m2025-11-12 21:00:53[0m | [1mINFO    [0m | [36mopportunity_scanner:scan:71             [0m | [1mâ­ï¸  Skipped opportunities for symbols: CC (temporary filter)[0m
[32m2025-11-12 21:00:53[0m | [1mINFO    [0m | [36mopportunity_scanner:scan:73             [0m | [1mFound 1 opportunities[0m
[32m2025-11-12 21:00:53[0m | [1mINFO    [0m | [36mopportunity:_calculate_position_size:210[0m | [1mðŸ“Š [DYDX] Calculated position size: target_margin=$140.00 Ã— leverage=5x = $700.00 exposure[0m
[32m2025-11-12 21:00:53[0m | [1mINFO    [0m | [36mopportunity:_calculate_position_size:210[0m | [1mðŸ“Š [DYDX] Calculated position size: target_margin=$140.00 Ã— leverage=5x = $700.00 exposure[0m
[32m2025-11-12 21:00:54[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m=======================================================[0m
[32m2025-11-12 21:00:54[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m1. ðŸ“‹ DYDX â€¢ Opportunity Validation[0m
[32m2025-11-12 21:00:54[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m=======================================================[0m
[32m2025-11-12 21:00:54[0m | [1mINFO    [0m | [36mposition_opener:_execute_trade:165      [0m | [1mEnsuring DYDX is tradeable on both paradex and lighter[0m
[32m2025-11-12 21:00:54[0m | [1mINFO    [0m | [36m...:_ensure_contract_attributes:929     [0m | [1mðŸ”§ [PARADEX] Initializing contract attributes for DYDX[0m
[32m2025-11-12 21:00:54[0m | [1mINFO    [0m | [36m...:_ensure_contract_attributes:947     [0m | [1mâœ… [PARADEX] DYDX initialized â†’ contract_id=DYDX-USD-PERP, tick_size=0.0001[0m
[32m2025-11-12 21:00:54[0m | [1mINFO    [0m | [36mposition_opener:_execute_trade:184      [0m | [1mâœ… DYDX available on both PARADEX and LIGHTER[0m
[32m2025-11-12 21:00:54[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m=======================================================[0m
[32m2025-11-12 21:00:54[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m2. ðŸ” Leverage Validation & Normalization[0m
[32m2025-11-12 21:00:54[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m=======================================================[0m
[32m2025-11-12 21:00:55[0m | [1mINFO    [0m | [36maccount_manager:get_account_balance:133 [0m | [1m[LIGHTER] get_account_balance WebSocket user_stats not available, using REST fallback (300 weight)[0m
[32m2025-11-12 21:00:56[0m | [1mINFO    [0m | [36mleverage_valid:get_max_position_size:266[0m | [1mâœ… [LEVERAGE] Position size $700.00 supported by all exchanges[0m
[32m2025-11-12 21:00:56[0m | [1mINFO    [0m | [36m...:normalize_and_set_leverage:329      [0m | [1mðŸ“Š [PARADEX] Max leverage for DYDX: 20x[0m
[32m2025-11-12 21:00:56[0m | [1mINFO    [0m | [36m...:normalize_and_set_leverage:329      [0m | [1mðŸ“Š [LIGHTER] Max leverage for DYDX: 5x[0m
[32m2025-11-12 21:00:56[0m | [1mINFO    [0m | [36m...:normalize_and_set_leverage:345      [0m | [1mðŸ”§ [LEVERAGE] Normalizing to minimum leverage: 5x (limited by lighter)[0m
[32m2025-11-12 21:00:56[0m | [1mINFO    [0m | [36maccount_manager:set_account_leverage:367[0m | [1m[PARADEX] Setting leverage for DYDX (DYDX-USD-PERP) to 5x...[0m
[32m2025-11-12 21:00:56[0m | [1mINFO    [0m | [36maccount_manager:set_account_leverage:389[0m | [1mâœ… [PARADEX] Successfully set leverage to 5x for DYDX (DYDX-USD-PERP)[0m
[32m2025-11-12 21:00:56[0m | [1mINFO    [0m | [36m...:normalize_and_set_leverage:363      [0m | [1mâœ… [PARADEX] Leverage set to 5x for DYDX[0m
[32m2025-11-12 21:00:56[0m | [33m[1mWARNING [0m | [36m...:normalize_and_set_leverage:355      [0m | [33m[1mâš ï¸  [LIGHTER] Does not support set_account_leverage(), skipping[0m
[32m2025-11-12 21:00:56[0m | [1mINFO    [0m | [36m...:normalize_and_set_leverage:375      [0m | [1mâœ… [LEVERAGE] All exchanges normalized to 5x for DYDX[0m
[32m2025-11-12 21:00:56[0m | [1mINFO    [0m | [36mposition_opener:_execute_trade:203      [0m | [1mðŸŽ¯ Execution plan for DYDX: Long PARADEX ($700.00) | Short LIGHTER ($700.00) | Divergence 0.030%[0m
[32m2025-11-12 21:00:56[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m=======================================================[0m
[32m2025-11-12 21:00:56[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m3. ðŸ§¨ Atomic Multi-Order Execution[0m
[32m2025-11-12 21:00:56[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m=======================================================[0m
[32m2025-11-12 21:00:57[0m | [1mINFO    [0m | [36mprice_provider:_fetch_exchange_bbo:76   [0m | [1mâœ… [PARADEX] BBO: bid=0.3084, ask=0.31[0m
[32m2025-11-12 21:00:57[0m | [1mINFO    [0m | [36mprice_provider:_fetch_exchange_bbo:76   [0m | [1mâœ… [LIGHTER] BBO: bid=0.3086, ask=0.30862[0m
[32m2025-11-12 21:00:57[0m | [1mINFO    [0m | [36mexecutor:execute_atomically:111         [0m | [1mStarting atomic execution of 2 orders (rollback_on_partial=True)[0m
[32m2025-11-12 21:00:57[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m=======================================================[0m
[32m2025-11-12 21:00:57[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m3.1. ðŸ” Pre-flight Checks[0m
[32m2025-11-12 21:00:57[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m=======================================================[0m
[32m2025-11-12 21:00:57[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m=======================================================[0m
[32m2025-11-12 21:00:57[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m3.1.2. ðŸ’° Margin & Balance Checks[0m
[32m2025-11-12 21:00:57[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m=======================================================[0m
[32m2025-11-12 21:00:57[0m | [1mINFO    [0m | [36mexecutor:_run_preflight_checks:1191     [0m | [1mRunning balance checks...[0m
[32m2025-11-12 21:00:57[0m | [1mINFO    [0m | [36maccount_manager:get_leverage_info:291   [0m | [1mðŸ“Š [PARADEX] Leverage info for DYDX:
  - Symbol max leverage: 20.0x
  - Account leverage: N/Ax
  - Max notional: 4860000
  - Margin requirement: 0.0500 (5.0%)[0m
[32m2025-11-12 21:00:57[0m | [1mINFO    [0m | [36maccount_manager:get_leverage_info:258   [0m | [1mðŸ“Š [LIGHTER] Leverage info for DYDX:
  - Symbol max leverage: 5.0x
  - Account leverage: 5E+2x
  - Max notional: None
  - Margin requirement: 0.2 (20.0%)[0m
[32m2025-11-12 21:00:57[0m | [1mINFO    [0m | [36mexecutor:_run_preflight_checks:1258     [0m | [1mâœ… paradex balance OK: $227.34 >= $38.50[0m
[32m2025-11-12 21:00:57[0m | [1mINFO    [0m | [36maccount_manager:get_account_balance:133 [0m | [1m[LIGHTER] get_account_balance WebSocket user_stats not available, using REST fallback (300 weight)[0m
[32m2025-11-12 21:00:58[0m | [1mINFO    [0m | [36mexecutor:_run_preflight_checks:1258     [0m | [1mâœ… lighter balance OK: $153.55 >= $153.31[0m
[32m2025-11-12 21:00:58[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m=======================================================[0m
[32m2025-11-12 21:00:58[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m3.1.3. ðŸŒŠ Order Book Liquidity[0m
[32m2025-11-12 21:00:58[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m=======================================================[0m
[32m2025-11-12 21:00:58[0m | [1mINFO    [0m | [36mexecutor:_run_preflight_checks:1263     [0m | [1mRunning liquidity checks...[0m
[32m2025-11-12 21:00:58[0m | [1mINFO    [0m | [36mmarket_data:get_order_book_depth:216    [0m | [1mðŸ“¡ [PARADEX] Using WebSocket order book with exact BBO prices: DYDX-USD-PERP (3 bids, 1 asks) | Best: 0.3084/0.31 | Spread: 52 bps[0m
[32m2025-11-12 21:00:58[0m | [1mINFO    [0m | [36m...:check_execution_feasibility:172     [0m | [1mðŸ“Š [LIQUIDITY-paradex] DYDX: 3 bids, 1 asks | Best: 0.3084/0.31 | Spread: 51 bps[0m
[32m2025-11-12 21:00:58[0m | [1mINFO    [0m | [36m...:check_execution_feasibility:189     [0m | [1mðŸ“ˆ [LIQUIDITY-paradex] Fill analysis: Can fill: True, Levels needed: 1/1, Total available: $700.01[0m
[32m2025-11-12 21:00:58[0m | [1mINFO    [0m | [36m...:check_execution_feasibility:239     [0m | [1mâœ… [LIQUIDITY-paradex] VERDICT for buy $700.011 DYDX: Recommendation='use_limit' | Score=0.90 | Slippage=0.000% | Spread=51bps[0m
[32m2025-11-12 21:00:58[0m | [1mINFO    [0m | [36mmarket_data:get_order_book_depth:360    [0m | [1mðŸ“¡ [LIGHTER] Using real-time order book from WebSocket (20 bids, 20 asks)[0m
[32m2025-11-12 21:00:58[0m | [1mINFO    [0m | [36m...:check_execution_feasibility:172     [0m | [1mðŸ“Š [LIQUIDITY-lighter] DYDX: 20 bids, 20 asks | Best: 0.3086/0.30862 | Spread: 0 bps[0m
[32m2025-11-12 21:00:58[0m | [1mINFO    [0m | [36m...:check_execution_feasibility:189     [0m | [1mðŸ“ˆ [LIQUIDITY-lighter] Fill analysis: Can fill: True, Levels needed: 4/20, Total available: $696.85[0m
[32m2025-11-12 21:00:58[0m | [1mINFO    [0m | [36m...:check_execution_feasibility:239     [0m | [1mâœ… [LIQUIDITY-lighter] VERDICT for sell $696.84966 DYDX: Recommendation='use_limit' | Score=0.98 | Slippage=0.078% | Spread=0bps[0m
[32m2025-11-12 21:00:58[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m=======================================================[0m
[32m2025-11-12 21:00:58[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m3.1.4. ðŸ’µ Minimum Order Notional[0m
[32m2025-11-12 21:00:58[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m=======================================================[0m
[32m2025-11-12 21:00:58[0m | [1mINFO    [0m | [36mexecutor:_run_preflight_checks:1292     [0m | [1mValidating minimum notional requirements...[0m
[32m2025-11-12 21:00:58[0m | [1mINFO    [0m | [36mexecutor:_run_preflight_checks:1324     [0m | [1mâœ… [PARADEX] DYDX notional $700.01 meets minimum $10.00[0m
[32m2025-11-12 21:00:58[0m | [1mINFO    [0m | [36mexecutor:_run_preflight_checks:1324     [0m | [1mâœ… [LIGHTER] DYDX notional $696.85 meets minimum $10.00[0m
[32m2025-11-12 21:00:58[0m | [1mINFO    [0m | [36mexecutor:_run_preflight_checks:1329     [0m | [1mâœ… All pre-flight checks passed[0m
[32m2025-11-12 21:00:58[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m=======================================================[0m
[32m2025-11-12 21:00:58[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m3.2. ðŸš€ Order Placement[0m
[32m2025-11-12 21:00:58[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m=======================================================[0m
[32m2025-11-12 21:00:58[0m | [1mINFO    [0m | [36mexecutor:execute_atomically:138         [0m | [1mðŸš€ Placing all orders simultaneously...[0m
[32m2025-11-12 21:00:58[0m | [1mINFO    [0m | [36morder_executor:execute_order:173        [0m | [1mðŸŸ¢ [PARADEX] Executing buy DYDX ($700.011 qty=2258.1) in mode limit_only[0m
[32m2025-11-12 21:00:58[0m | [1mINFO    [0m | [36mprice_provider:_fetch_exchange_bbo:76   [0m | [1mâœ… [PARADEX] BBO: bid=0.3084, ask=0.31[0m
[32m2025-11-12 21:00:58[0m | [1mINFO    [0m | [36morder_executor:_execute_limit:311       [0m | [1m[PARADEX] Placing limit buy DYDX (contract_id=DYDX-USD-PERP): 2258.1 @ $0.3099 (mid: $0.3092, offset: 0.0200%)[0m
[32m2025-11-12 21:00:58[0m | [1mINFO    [0m | [36morder_executor:execute_order:173        [0m | [1mðŸ”´ [LIGHTER] Executing sell DYDX ($696.84966 qty=2258.1) in mode limit_only[0m
[32m2025-11-12 21:00:58[0m | [1mINFO    [0m | [36mprice_provider:_fetch_exchange_bbo:76   [0m | [1mâœ… [LIGHTER] BBO: bid=0.3086, ask=0.30862[0m
[32m2025-11-12 21:00:58[0m | [1mINFO    [0m | [36morder_executor:_execute_limit:311       [0m | [1m[LIGHTER] Placing limit sell DYDX (contract_id=62): 2258.1 @ $0.30866 (mid: $0.30861, offset: 0.0200%)[0m
[32m2025-11-12 21:00:58[0m | [1mINFO    [0m | [36morder_manager:place_limit_order:185     [0m | [1mðŸ“¤ [LIGHTER] Submitting order: market=62 client_id=258131 side=ASK price=30866 amount=22581[0m
[32m2025-11-12 21:00:59[0m | [1mINFO    [0m | [36m...:handle_websocket_order_update:171   [0m | [1m[WEBSOCKET] [LIGHTER] OPEN 2258.1 @ 0.30866[0m
[32m2025-11-12 21:00:59[0m | [1mINFO    [0m | [36m...:handle_websocket_order_update:107   [0m | [1m[WEBSOCKET] [PARADEX] FILLED 2258.1 @ 0.3099[0m
[32m2025-11-12 21:00:59[0m | [1mINFO    [0m | [36morder_executor:_execute_limit:445       [0m | [1m[PARADEX] Limit order filled: 2258.1 @ $0.3099[0m
[32m2025-11-12 21:00:59[0m | [1mINFO    [0m | [36mexecutor:_handle_full_fill_trigger:814  [0m | [1mâœ… PARADEX DYDX fully filled (2258.1). Cancelling remaining limit orders and hedging to prevent directional exposure.[0m
[32m2025-11-12 21:00:59[0m | [1mINFO    [0m | [36mexecutor:_handle_full_fill_trigger:823  [0m | [1mðŸ”„ Cancelling limit order for LIGHTER DYDX (remaining: 2258.1) â†’ will hedge with market order[0m
[32m2025-11-12 21:00:59[0m | [1mINFO    [0m | [36morder_executor:_execute_limit:400       [0m | [1m[LIGHTER] Cancellation requested for limit order 258131[0m
[32m2025-11-12 21:01:00[0m | [1mINFO    [0m | [36m...:handle_websocket_order_update:182   [0m | [1m[WEBSOCKET] [LIGHTER] CANCELED 0.0 @ 0.30866[0m
[32m2025-11-12 21:01:00[0m | [1mINFO    [0m | [36m...:handle_websocket_order_update:212   [0m | [1mTRANSACTION: SELL 0.0 @ 0.30866 | Order: 258131 | Status: CANCELED[0m
[32m2025-11-12 21:01:00[0m | [1mINFO    [0m | [36mhedge_manager:hedge:80                  [0m | [1mâš¡ Hedging DYDX on LIGHTER for remaining qty=2258.1, $696.85[0m
[32m2025-11-12 21:01:00[0m | [1mINFO    [0m | [36morder_executor:execute_order:173        [0m | [1mðŸ”´ [LIGHTER] Executing sell DYDX (qty=2258.1) in mode market_only[0m
[32m2025-11-12 21:01:00[0m | [1mINFO    [0m | [36mprice_provider:_fetch_exchange_bbo:76   [0m | [1mâœ… [LIGHTER] BBO: bid=0.30862, ask=0.30865[0m
[32m2025-11-12 21:01:00[0m | [1mINFO    [0m | [36morder_executor:_execute_market:588      [0m | [1m[LIGHTER] Placing market sell DYDX (contract_id=62): 2258.1 @ ~$0.30862[0m
[32m2025-11-12 21:01:00[0m | [1mINFO    [0m | [36morder_manager:place_market_order:392    [0m | [1mðŸ“¤ [LIGHTER] Placing market order: market=62, client_id=260638, side=SELL, base_amount=22581, avg_execution_price=29320[0m
[32m2025-11-12 21:01:01[0m | [1mINFO    [0m | [36m...:handle_websocket_order_update:182   [0m | [1m[WEBSOCKET] [LIGHTER] FILLED 2258.1 @ 0.29320[0m
[32m2025-11-12 21:01:01[0m | [1mINFO    [0m | [36m...:handle_websocket_order_update:212   [0m | [1mTRANSACTION: SELL 2258.1 @ 0.29320 | Order: 260638 | Status: FILLED[0m
[32m2025-11-12 21:01:01[0m | [1mINFO    [0m | [36morder_executor:_execute_market:714      [0m | [1m[LIGHTER] Market order filled: 2258.1 @ $0.29320 (slippage: $34.82 / 4.996%)[0m
[32m2025-11-12 21:01:01[0m | [31m[1mERROR   [0m | [36mexecutor:execute_atomically:339         [0m | [31m[1mâš ï¸ CRITICAL IMBALANCE detected despite all orders filled: longs=$699.79, shorts=$662.07, imbalance=$37.71 (5.4%). Triggering emergency rollback.[0m
[32m2025-11-12 21:01:01[0m | [33m[1mWARNING [0m | [36mexecutor:_rollback_filled_orders:1339   [0m | [33m[1mðŸš¨ EMERGENCY ROLLBACK: Closing 2 filled orders[0m
[32m2025-11-12 21:01:01[0m | [1mINFO    [0m | [36mexecutor:_rollback_filled_orders:1345   [0m | [1mStep 1/3: Canceling all orders to prevent further fills...[0m
[32m2025-11-12 21:01:02[0m | [31m[1mERROR   [0m | [36morder_manager:cancel_order:364          [0m | [31m[1mFailed to cancel order 1762981258280201709226190010: ApiError(error='ORDER_IS_CLOSED', message='order is closed: 1762981258280201709226190010', data=None)[0m
[32m2025-11-12 21:01:02[0m | [1mINFO    [0m | [36mexecutor:_rollback_filled_orders:1364   [0m | [1mStep 2/3: Querying actual filled amounts...[0m
[32m2025-11-12 21:01:02[0m | [1mINFO    [0m | [36mexecutor:_rollback_filled_orders:1434   [0m | [1mStep 3/3: Closing 2 filled positions...[0m
[32m2025-11-12 21:01:02[0m | [1mINFO    [0m | [36mexecutor:_rollback_filled_orders:1444   [0m | [1mRollback: sell DYDX 2258.1 @ market (contract_id=DYDX-USD-PERP, exchange=paradex)[0m
[32m2025-11-12 21:01:02[0m | [1mINFO    [0m | [36mexecutor:_rollback_filled_orders:1444   [0m | [1mRollback: buy DYDX 2258.1 @ market (contract_id=62, exchange=lighter)[0m
[32m2025-11-12 21:01:02[0m | [1mINFO    [0m | [36morder_manager:place_market_order:392    [0m | [1mðŸ“¤ [LIGHTER] Placing market order: market=62, client_id=262656, side=BUY, base_amount=22581, avg_execution_price=32371[0m
[32m2025-11-12 21:01:03[0m | [1mINFO    [0m | [36m...:handle_websocket_order_update:107   [0m | [1m[WEBSOCKET] [PARADEX] CANCELED 748.2 @ 0.3079[0m
[32m2025-11-12 21:01:03[0m | [1mINFO    [0m | [36m...:handle_websocket_order_update:182   [0m | [1m[WEBSOCKET] [LIGHTER] FILLED 2258.1 @ 0.32371[0m
[32m2025-11-12 21:01:03[0m | [1mINFO    [0m | [36m...:handle_websocket_order_update:212   [0m | [1mTRANSACTION: BUY 2258.1 @ 0.32371 | Order: 262656 | Status: FILLED[0m
[32m2025-11-12 21:01:03[0m | [33m[1mWARNING [0m | [36m...:handle_positions_stream_update:435  [0m | [33m[1mâš ï¸ [LIGHTER] Position suddenly zeroed: DYDX | Previous qty: 2258.1 | Market ID: 62 | Possible liquidation (no liquidation notification received)[0m
[32m2025-11-12 21:01:03[0m | [33m[1mWARNING [0m | [36mexecutor:_rollback_filled_orders:1488   [0m | [33m[1mRollback cost for DYDX: $4.52 (entry: $0.3099, exit: $0.3079)[0m
[32m2025-11-12 21:01:03[0m | [33m[1mWARNING [0m | [36mexecutor:_rollback_filled_orders:1488   [0m | [33m[1mRollback cost for DYDX: $0.00 (entry: $0.29320, exit: $0.29320)[0m
[32m2025-11-12 21:01:03[0m | [33m[1mWARNING [0m | [36mexecutor:_rollback_filled_orders:1493   [0m | [33m[1mâœ… Rollback complete. Total cost: $4.52[0m
[32m2025-11-12 21:01:03[0m | [33m[1mWARNING [0m | [36m...:_perform_emergency_rollback:725     [0m | [33m[1mðŸ›¡ï¸ Emergency rollback completed; cost=$4.5162. Prevented $37.71 (5.4%) directional exposure.[0m
[32m2025-11-12 21:01:03[0m | [31m[1mERROR   [0m | [36mposition_opener:_execute_trade:242      [0m | [31m[1mâŒ DYDX: Atomic execution failed - Rolled back due to critical imbalance: $37.71[0m
[32m2025-11-12 21:01:03[0m | [33m[1mWARNING [0m | [36mposition_opener:_execute_trade:247      [0m | [33m[1mðŸ”„ Emergency rollback performed, cost: $4.52[0m


## 7. NEXT ITERATION, try to open new position
- but now, we no longer have enough balance to open a new posiiton due to not enough balance, which is fine and expected/


[32m2025-11-12 21:01:54[0m | [1mINFO    [0m | [36mstrategy:execute_strategy:229           [0m | [1mScanning for new funding arbitrage opportunities[0m
[32m2025-11-12 21:01:54[0m | [1mINFO    [0m | [36mopportunity_finde:find_opportunities:171[0m | [1mFound 0 raw opportunities, 0 after filtering, returning top 0[0m
[32m2025-11-12 21:01:54[0m | [1mINFO    [0m | [36mopportunity_scanner:scan:73             [0m | [1mFound 0 opportunities[0m
[32m2025-11-12 21:02:54[0m | [1mINFO    [0m | [36mstrategy:execute_strategy:229           [0m | [1mScanning for new funding arbitrage opportunities[0m
[32m2025-11-12 21:02:54[0m | [1mINFO    [0m | [36mopportunity_finde:find_opportunities:171[0m | [1mFound 2 raw opportunities, 2 after filtering, returning top 2[0m
[32m2025-11-12 21:02:54[0m | [1mINFO    [0m | [36mopportunity_scanner:scan:71             [0m | [1mâ­ï¸  Skipped opportunities for symbols: CC (temporary filter)[0m
[32m2025-11-12 21:02:54[0m | [1mINFO    [0m | [36mopportunity_scanner:scan:73             [0m | [1mFound 1 opportunities[0m
[32m2025-11-12 21:02:54[0m | [1mINFO    [0m | [36mopportunity:_calculate_position_size:210[0m | [1mðŸ“Š [DYDX] Calculated position size: target_margin=$140.00 Ã— leverage=5x = $700.00 exposure[0m
[32m2025-11-12 21:02:54[0m | [1mINFO    [0m | [36mopportunity:_calculate_position_size:210[0m | [1mðŸ“Š [DYDX] Calculated position size: target_margin=$140.00 Ã— leverage=5x = $700.00 exposure[0m
[32m2025-11-12 21:02:54[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m=======================================================[0m
[32m2025-11-12 21:02:54[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m1. ðŸ“‹ DYDX â€¢ Opportunity Validation[0m
[32m2025-11-12 21:02:54[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m=======================================================[0m
[32m2025-11-12 21:02:54[0m | [1mINFO    [0m | [36mposition_opener:_execute_trade:165      [0m | [1mEnsuring DYDX is tradeable on both paradex and lighter[0m
[32m2025-11-12 21:02:54[0m | [1mINFO    [0m | [36m...:_ensure_contract_attributes:929     [0m | [1mðŸ”§ [PARADEX] Initializing contract attributes for DYDX[0m
[32m2025-11-12 21:02:54[0m | [1mINFO    [0m | [36m...:_ensure_contract_attributes:947     [0m | [1mâœ… [PARADEX] DYDX initialized â†’ contract_id=DYDX-USD-PERP, tick_size=0.0001[0m
[32m2025-11-12 21:02:54[0m | [1mINFO    [0m | [36mposition_opener:_execute_trade:184      [0m | [1mâœ… DYDX available on both PARADEX and LIGHTER[0m
[32m2025-11-12 21:02:54[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m=======================================================[0m
[32m2025-11-12 21:02:54[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m2. ðŸ” Leverage Validation & Normalization[0m
[32m2025-11-12 21:02:54[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m=======================================================[0m
[32m2025-11-12 21:02:55[0m | [1mINFO    [0m | [36maccount_manager:get_account_balance:133 [0m | [1m[LIGHTER] get_account_balance WebSocket user_stats not available, using REST fallback (300 weight)[0m
[32m2025-11-12 21:02:56[0m | [1mINFO    [0m | [36mleverage_valid:get_max_position_size:266[0m | [1mâœ… [LEVERAGE] Position size $700.00 supported by all exchanges[0m
[32m2025-11-12 21:02:56[0m | [1mINFO    [0m | [36m...:normalize_and_set_leverage:329      [0m | [1mðŸ“Š [PARADEX] Max leverage for DYDX: 20x[0m
[32m2025-11-12 21:02:56[0m | [1mINFO    [0m | [36m...:normalize_and_set_leverage:329      [0m | [1mðŸ“Š [LIGHTER] Max leverage for DYDX: 5x[0m
[32m2025-11-12 21:02:56[0m | [1mINFO    [0m | [36m...:normalize_and_set_leverage:345      [0m | [1mðŸ”§ [LEVERAGE] Normalizing to minimum leverage: 5x (limited by lighter)[0m
[32m2025-11-12 21:02:56[0m | [1mINFO    [0m | [36maccount_manager:set_account_leverage:367[0m | [1m[PARADEX] Setting leverage for DYDX (DYDX-USD-PERP) to 5x...[0m
[32m2025-11-12 21:02:56[0m | [1mINFO    [0m | [36maccount_manager:set_account_leverage:389[0m | [1mâœ… [PARADEX] Successfully set leverage to 5x for DYDX (DYDX-USD-PERP)[0m
[32m2025-11-12 21:02:56[0m | [1mINFO    [0m | [36m...:normalize_and_set_leverage:363      [0m | [1mâœ… [PARADEX] Leverage set to 5x for DYDX[0m
[32m2025-11-12 21:02:56[0m | [33m[1mWARNING [0m | [36m...:normalize_and_set_leverage:355      [0m | [33m[1mâš ï¸  [LIGHTER] Does not support set_account_leverage(), skipping[0m
[32m2025-11-12 21:02:56[0m | [1mINFO    [0m | [36m...:normalize_and_set_leverage:375      [0m | [1mâœ… [LEVERAGE] All exchanges normalized to 5x for DYDX[0m
[32m2025-11-12 21:02:56[0m | [1mINFO    [0m | [36mposition_opener:_execute_trade:203      [0m | [1mðŸŽ¯ Execution plan for DYDX: Long PARADEX ($700.00) | Short LIGHTER ($700.00) | Divergence 0.031%[0m
[32m2025-11-12 21:02:56[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m=======================================================[0m
[32m2025-11-12 21:02:56[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m3. ðŸ§¨ Atomic Multi-Order Execution[0m
[32m2025-11-12 21:02:56[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m=======================================================[0m
[32m2025-11-12 21:02:57[0m | [1mINFO    [0m | [36mprice_provider:_fetch_exchange_bbo:76   [0m | [1mâœ… [PARADEX] BBO: bid=0.3085, ask=0.31[0m
[32m2025-11-12 21:02:57[0m | [1mINFO    [0m | [36mprice_provider:_fetch_exchange_bbo:76   [0m | [1mâœ… [LIGHTER] BBO: bid=0.30844, ask=0.30869[0m
[32m2025-11-12 21:02:57[0m | [1mINFO    [0m | [36mexecutor:execute_atomically:111         [0m | [1mStarting atomic execution of 2 orders (rollback_on_partial=True)[0m
[32m2025-11-12 21:02:57[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m=======================================================[0m
[32m2025-11-12 21:02:57[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m3.1. ðŸ” Pre-flight Checks[0m
[32m2025-11-12 21:02:57[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m=======================================================[0m
[32m2025-11-12 21:02:57[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m=======================================================[0m
[32m2025-11-12 21:02:57[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m3.1.2. ðŸ’° Margin & Balance Checks[0m
[32m2025-11-12 21:02:57[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m=======================================================[0m
[32m2025-11-12 21:02:57[0m | [1mINFO    [0m | [36mexecutor:_run_preflight_checks:1191     [0m | [1mRunning balance checks...[0m
[32m2025-11-12 21:02:57[0m | [1mINFO    [0m | [36maccount_manager:get_leverage_info:291   [0m | [1mðŸ“Š [PARADEX] Leverage info for DYDX:
  - Symbol max leverage: 20.0x
  - Account leverage: N/Ax
  - Max notional: 4860000
  - Margin requirement: 0.0500 (5.0%)[0m
[32m2025-11-12 21:02:57[0m | [1mINFO    [0m | [36maccount_manager:get_leverage_info:258   [0m | [1mðŸ“Š [LIGHTER] Leverage info for DYDX:
  - Symbol max leverage: 5.0x
  - Account leverage: 5E+2x
  - Max notional: None
  - Margin requirement: 0.2 (20.0%)[0m
[32m2025-11-12 21:02:58[0m | [1mINFO    [0m | [36mexecutor:_run_preflight_checks:1258     [0m | [1mâœ… paradex balance OK: $131.23 >= $38.50[0m
[32m2025-11-12 21:02:58[0m | [1mINFO    [0m | [36maccount_manager:get_account_balance:133 [0m | [1m[LIGHTER] get_account_balance WebSocket user_stats not available, using REST fallback (300 weight)[0m
[32m2025-11-12 21:02:58[0m | [31m[1mERROR   [0m | [36mexecutor:_run_preflight_checks:1245     [0m | [31m[1mâŒ Insufficient balance on lighter: available=$153.17, required=$153.23 ($139.30 + 10% buffer)[0m
[32m2025-11-12 21:02:58[0m | [31m[1mERROR   [0m | [36mposition_opener:_execute_trade:242      [0m | [31m[1mâŒ DYDX: Atomic execution failed - Pre-flight check failed: Insufficient balance on lighter: available=$153.17, required=$153.23 ($139.30 + 10% buffer)[0m
[32m2025-11-12 21:03:54[0m | [1mINFO    [0m | [36mstrategy:execute_strategy:229           [0m | [1mScanning for new funding arbitrage opportunities[0m
[32m2025-11-12 21:03:54[0m | [1mINFO    [0m | [36mopportunity_finde:find_opportunities:171[0m | [1mFound 2 raw opportunities, 2 after filtering, returning top 2[0m
[32m2025-11-12 21:03:54[0m | [1mINFO    [0m | [36mopportunity_scanner:scan:71             [0m | [1mâ­ï¸  Skipped opportunities for symbols: CC (temporary filter)[0m
[32m2025-11-12 21:03:54[0m | [1mINFO    [0m | [36mopportunity_scanner:scan:73             [0m | [1mFound 1 opportunities[0m
[32m2025-11-12 21:03:54[0m | [1mINFO    [0m | [36mopportunity:_calculate_position_size:210[0m | [1mðŸ“Š [DYDX] Calculated position size: target_margin=$140.00 Ã— leverage=5x = $700.00 exposure[0m
[32m2025-11-12 21:03:54[0m | [1mINFO    [0m | [36mopportunity:_calculate_position_size:210[0m | [1mðŸ“Š [DYDX] Calculated position size: target_margin=$140.00 Ã— leverage=5x = $700.00 exposure[0m
[32m2025-11-12 21:03:54[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m=======================================================[0m
[32m2025-11-12 21:03:54[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m1. ðŸ“‹ DYDX â€¢ Opportunity Validation[0m
[32m2025-11-12 21:03:54[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m=======================================================[0m
[32m2025-11-12 21:03:54[0m | [1mINFO    [0m | [36mposition_opener:_execute_trade:165      [0m | [1mEnsuring DYDX is tradeable on both paradex and lighter[0m
[32m2025-11-12 21:03:54[0m | [1mINFO    [0m | [36m...:_ensure_contract_attributes:929     [0m | [1mðŸ”§ [PARADEX] Initializing contract attributes for DYDX[0m
[32m2025-11-12 21:03:54[0m | [1mINFO    [0m | [36m...:_ensure_contract_attributes:947     [0m | [1mâœ… [PARADEX] DYDX initialized â†’ contract_id=DYDX-USD-PERP, tick_size=0.0001[0m
[32m2025-11-12 21:03:54[0m | [1mINFO    [0m | [36mposition_opener:_execute_trade:184      [0m | [1mâœ… DYDX available on both PARADEX and LIGHTER[0m
[32m2025-11-12 21:03:54[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m=======================================================[0m
[32m2025-11-12 21:03:54[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m2. ðŸ” Leverage Validation & Normalization[0m
[32m2025-11-12 21:03:54[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m=======================================================[0m
[32m2025-11-12 21:03:55[0m | [1mINFO    [0m | [36maccount_manager:get_account_balance:133 [0m | [1m[LIGHTER] get_account_balance WebSocket user_stats not available, using REST fallback (300 weight)[0m
[32m2025-11-12 21:03:56[0m | [1mINFO    [0m | [36mleverage_valid:get_max_position_size:266[0m | [1mâœ… [LEVERAGE] Position size $700.00 supported by all exchanges[0m
[32m2025-11-12 21:03:56[0m | [1mINFO    [0m | [36m...:normalize_and_set_leverage:329      [0m | [1mðŸ“Š [PARADEX] Max leverage for DYDX: 20x[0m
[32m2025-11-12 21:03:56[0m | [1mINFO    [0m | [36m...:normalize_and_set_leverage:329      [0m | [1mðŸ“Š [LIGHTER] Max leverage for DYDX: 5x[0m
[32m2025-11-12 21:03:56[0m | [1mINFO    [0m | [36m...:normalize_and_set_leverage:345      [0m | [1mðŸ”§ [LEVERAGE] Normalizing to minimum leverage: 5x (limited by lighter)[0m
[32m2025-11-12 21:03:56[0m | [1mINFO    [0m | [36maccount_manager:set_account_leverage:367[0m | [1m[PARADEX] Setting leverage for DYDX (DYDX-USD-PERP) to 5x...[0m
[32m2025-11-12 21:03:56[0m | [1mINFO    [0m | [36maccount_manager:set_account_leverage:389[0m | [1mâœ… [PARADEX] Successfully set leverage to 5x for DYDX (DYDX-USD-PERP)[0m
[32m2025-11-12 21:03:56[0m | [1mINFO    [0m | [36m...:normalize_and_set_leverage:363      [0m | [1mâœ… [PARADEX] Leverage set to 5x for DYDX[0m
[32m2025-11-12 21:03:56[0m | [33m[1mWARNING [0m | [36m...:normalize_and_set_leverage:355      [0m | [33m[1mâš ï¸  [LIGHTER] Does not support set_account_leverage(), skipping[0m
[32m2025-11-12 21:03:56[0m | [1mINFO    [0m | [36m...:normalize_and_set_leverage:375      [0m | [1mâœ… [LEVERAGE] All exchanges normalized to 5x for DYDX[0m
[32m2025-11-12 21:03:56[0m | [1mINFO    [0m | [36mposition_opener:_execute_trade:203      [0m | [1mðŸŽ¯ Execution plan for DYDX: Long PARADEX ($700.00) | Short LIGHTER ($700.00) | Divergence 0.031%[0m
[32m2025-11-12 21:03:56[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m=======================================================[0m
[32m2025-11-12 21:03:56[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m3. ðŸ§¨ Atomic Multi-Order Execution[0m
[32m2025-11-12 21:03:56[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m=======================================================[0m
[32m2025-11-12 21:03:57[0m | [1mINFO    [0m | [36mprice_provider:_fetch_exchange_bbo:76   [0m | [1mâœ… [PARADEX] BBO: bid=0.3087, ask=0.309[0m
[32m2025-11-12 21:03:57[0m | [1mINFO    [0m | [36mprice_provider:_fetch_exchange_bbo:76   [0m | [1mâœ… [LIGHTER] BBO: bid=0.30826, ask=0.30836[0m
[32m2025-11-12 21:03:57[0m | [1mINFO    [0m | [36mexecutor:execute_atomically:111         [0m | [1mStarting atomic execution of 2 orders (rollback_on_partial=True)[0m
[32m2025-11-12 21:03:57[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m=======================================================[0m
[32m2025-11-12 21:03:57[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m3.1. ðŸ” Pre-flight Checks[0m
[32m2025-11-12 21:03:57[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m=======================================================[0m
[32m2025-11-12 21:03:57[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m=======================================================[0m
[32m2025-11-12 21:03:57[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m3.1.2. ðŸ’° Margin & Balance Checks[0m
[32m2025-11-12 21:03:57[0m | [1mINFO    [0m | [36munified_logger:_emit:618                [0m | [1m=======================================================[0m
[32m2025-11-12 21:03:57[0m | [1mINFO    [0m | [36mexecutor:_run_preflight_checks:1191     [0m | [1mRunning balance checks...[0m
[32m2025-11-12 21:03:57[0m | [1mINFO    [0m | [36maccount_manager:get_leverage_info:291   [0m | [1mðŸ“Š [PARADEX] Leverage info for DYDX:
  - Symbol max leverage: 20.0x
  - Account leverage: N/Ax
  - Max notional: 4860000
  - Margin requirement: 0.0500 (5.0%)[0m
[32m2025-11-12 21:03:57[0m | [1mINFO    [0m | [36maccount_manager:get_leverage_info:258   [0m | [1mðŸ“Š [LIGHTER] Leverage info for DYDX:
  - Symbol max leverage: 5.0x
  - Account leverage: 5E+2x
  - Max notional: None
  - Margin requirement: 0.2 (20.0%)[0m
[32m2025-11-12 21:03:58[0m | [1mINFO    [0m | [36mexecutor:_run_preflight_checks:1258     [0m | [1mâœ… paradex balance OK: $130.96 >= $38.50[0m
[32m2025-11-12 21:03:58[0m | [1mINFO    [0m | [36maccount_manager:get_account_balance:133 [0m | [1m[LIGHTER] get_account_balance WebSocket user_stats not available, using REST fallback (300 weight)[0m
[32m2025-11-12 21:03:58[0m | [31m[1mERROR   [0m | [36mexecutor:_run_preflight_checks:1245     [0m | [31m[1mâŒ Insufficient balance on lighter: available=$153.17, required=$153.63 ($139.67 + 10% buffer)[0m
[32m2025-11-12 21:03:58[0m | [31m[1mERROR   [0m | [36mposition_opener:_execute_trade:242      [0m | [31m[1mâŒ DYDX: Atomic execution failed - Pre-flight check failed: Insufficient balance on lighter: available=$153.17, required=$153.63 ($139.67 + 10% buffer)[0m